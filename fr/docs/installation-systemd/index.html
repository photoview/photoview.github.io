<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Utilisation avec systemd - Photoview Documentation</title><link rel="stylesheet" href="/main.css"><link rel="stylesheet" href="/docs/style.css"><link href="/docs/syntax-theme.css" rel="stylesheet"><script defer="defer" data-domain="photoview.github.io" src="https://analytics.qpqp.dk/js/plausible.outbound-links.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script></head><body><div class="mx-4 relative"><div class="max-w-screen-2xl m-auto flex items-start min-h-screen"><aside class="w-56 sticky top-0 docs-nav flex-shrink-0"><div class="overflow-y-auto max-h-screen pr-4"><a href="/"><img class="my-8" src="/images/logo-large.svg" alt="Photoview logo" height="60"> </a><input id="nav-search-field" type="search" placeholder="Search" class="pointer mb-4 w-full py-2 px-3 text-sm border border-gray-200 rounded-md"><nav class="mb-8"><ul><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/">Introduction</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/getting-started/">Démarrer</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/faq/">FAQ</a></li><li class=""><span class="ml-3 mt-6 block uppercase text-gray-600 font-bold text-xs tracking-wider">Installation</span><ul><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/installation-docker/">Installation avec Docker</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/installation-manual/">Installation manuelle</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm bg-blue-50 text-primaryDark hover:text-primaryDark" href="/fr/docs/installation-systemd/" aria-current="page">Utilisation avec systemd</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/installation-environment-variables/">Variables d&#39;environnement</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/installation-reverse-proxies/">Reverse Proxy</a></li></ul></li><li class=""><span class="ml-3 mt-6 block uppercase text-gray-600 font-bold text-xs tracking-wider">Utilisation</span><ul><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-basic-overview/">Utilisation basique</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-nextcloud/">Utilisation avec Nextcloud</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-people/">Reconnaissance faciale</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-places/">Lieux</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-scanner/">Analyseur (scanneur) de fichiers</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-settings/">Page des paramètres</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/usage-sharing/">Partage des albums et des médias</a></li></ul></li><li class=""><span class="ml-3 mt-6 block uppercase text-gray-600 font-bold text-xs tracking-wider">Contribuer</span><ul><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/contribute-how-to/">Comment contribuer</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/contribute-feature-request/">Signaler des bugs</a></li><li><a class="px-3 py-1 block no-underline hover:no-underline text-sm text-black hover:text-gray-900 hover:bg-gray-100" href="/fr/docs/contribute-setup-locally/">Mettre en place l&#39;environnement de développement</a></li></ul></li></ul></nav></div></aside><style>.docs-nav::before {
        content: '';
        background-color: rgb(249, 250, 251);
        position: absolute;
        z-index: -1;
        top: 0;
        right: 0;
        width: 100vw;
        height: 100vh;
      }</style><aside id="content-toc" class="w-48 sticky docs-toc order-3 flex-shrink-0"><span class="block uppercase text-gray-600 font-bold text-xs tracking-wider pt-0">Contents</span><nav class="toc"><ol><li><a href="#utilisation-avec-systemd">Utilisation avec systemd</a><ol><li><a href="#utiliser-le-fichier-systemd">Utiliser le fichier systemd</a></li></ol></li></ol></nav></aside><main id="primary-content" class="mb-40 w-full px-14 py-14"><header class="flex justify-between items-center"><h1>Utilisation avec systemd</h1><div class="flex items-center"><a title="Edit on GitHub" class="text-gray-500 hover:text-primaryDark no-underline" href="https://github.com/photoview/photoview.github.io/edit/master/./src/fr/docs/installation-systemd.md"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg> </a><select class="ml-5" id="lg-switcher" onchange="changeLanguage()"><option class="lg-switcher-item" value="/en/docs/installation-systemd/">English</option><option class="lg-switcher-item" selected="selected" value="/fr/docs/installation-systemd/">Français</option></select><script>function changeLanguage() {
      document.location.href=document.getElementById("lg-switcher").value;
    }</script></div></header><p>Vous pouvez, de manière optionnelle utiliser <code>systemd</code> pour gérer Photoview et démarrer le programme au démarrage du serveur. Cela améliore encore la sécurité du process car le programme tourne alors avec son propre utilisateur système.</p><p>Pour démarrer, suivez le <a href="/fr/docs/installation-manual/">Guide d'installation manuelle</a>.</p><p>Lorsque vous arrivez à la section <em>Copiez UI et back-end au bon endroit</em>, remplacez les étapes par les étapes décrites ci-après.</p><h2 id="utilisation-avec-systemd" tabindex="-1"><a class="header-anchor" href="#utilisation-avec-systemd" aria-label="Anchor"></a> Utilisation avec <code>systemd</code></h2><p>Les trois premiers fichiers des étapes suivantes permettent à <code>systemd</code> de faire tourner photoview avec <code>user:group</code> étant égal à <code>photoview:photoview</code>. Cela limite les permissions du programme, ajoutant (un petit peu) de sécurité en limitant ses accès aux fichiers et répertoires auquels le process a explicitement accès.</p><p>Cela nécessite également que votre répertoire <code>PHOTOVIEW_MEDIA_CACHE</code> (et <code>PHOTOVIEW_SQLITE_PATH</code> si vous utilisez <code>sqlite</code>) soit accessible en lecture et en écriture à l'utilisateur <code>photoview</code>. Si c'est la première fois que vous installez photoview, les permissions devraient être gérée automatiquement. Si vous faites une mise à jour, et que des fichiers se trouvent déjà dans ce répertoire, vous devez vérifier les droits d'accès et éventuellement changer les droits de manière récursive avec la commande <code>chown</code>.</p><p>Enfin, <code>systemd</code> fonctionne généralement sur une hiérarchie de chemins système. C'est à dire qu'au lieu d'installer tout ensemble sous <code>/opt/</code>, les fichiers du programme seront placés dans <code>/usr</code>, <code>/lib/</code>, et <code>/var</code>. Ayez conscience que, quelque soit le chemin, les fichiers générés dans <code>PHOTOVIEW_MEDIA_CACHE</code> peuvent prendre beaucoup de place si votre bibliothèque de médias est importante. Si c'est un problème, vous pouvez changer facilement la localisation de ce répertoire. Il faudra alors faire attention de répercuter ces changement dans les variables <code>photoview.service</code> et <code>photoview.tmpfiles</code> du fichier proposé ci-après.</p><blockquote><p>Rappel : Ces étapes remplacent celles de la rubrique <em>Copiez UI et back-end au bon endroit</em> du guide d'installation manuelle.</p></blockquote><ol><li>Créez l'utilisateur et le groupe <code>photoview</code>:<ul><li><code>$ sudo adduser photoview --system --group --no-create-home</code></li></ul></li><li>Copiez les fichiers <code>systemd</code>:<ul><li><code>systemd/photoview.service</code> vers <code>/etc/systemd/system/multi-user.target/photoview.service</code></li><li><code>systemd/photoview.sysusers.conf</code> vers <code>/usr/lib/sysusers.d/photoview.conf</code></li><li><code>systemd/photoview.tmpfiles</code> vers <code>/usr/lib/tmpfiles.d/photoview.conf</code></li></ul><blockquote><p>Si vous n'utilisez pas <code>sqlite</code>, supprimez la 2ème ligne de <code>systemd/photoview.tmpfiles</code> et la ligne <code>ReadWritePaths=/var/lib/photoview</code> de <code>systemd/photoview.service</code> avant la copie.</p></blockquote></li><li>Créez les répertoires dans lesquels les fichiers du programme seront placés :<blockquote><p>A noter : la commande <code>install</code>, comme expliqué ci-dessous, crée les répertoires requis.</p></blockquote><ul><li><code>/usr/share/webapps/photoview-ui</code></li><li><code>/usr/lib/photoview</code></li><li><code>/var/cache/photoview/media_cache</code></li><li><code>/var/lib/photoview</code> (pour le chemin sqlite, si utilisé)</li></ul></li><li>Copiez les fichiers buildés vers les répertoires appropriés</li><li>Si vous mettez à jour à partir d'une version où vous n'utilisiez pas le service <code>systemd</code> :<ul><li>Modifiez les droits du répertoire de cache des médias (et du répertoire sqlite, si utilisé)<ul><li><code>$ sudo chown -R photoview:photoview /var/cache/photoview</code></li><li><code>$ sudo chown -R photoview:photoview /var/lib/photoview</code></li></ul></li></ul></li><li>S'il s'agit d'une <em>fresh install</em>, assurez-vous que les chemins des fichiers sont bien réglés pour être la propriété du user et du group <code>photoview</code> avec les droits de lecture et écriture.</li></ol><p>Exemple de ce que donnent ces étapes :</p><pre class="language-shell"><code class="language-shell">$ <span class="token function">sudo</span> adduser photoview --system --group --no-create-home<br>$ <span class="token builtin class-name">cd</span> /opt/photoview<br>$ <span class="token function">sudo</span> <span class="token function">install</span> -Dm0644 -t <span class="token string">"/usr/lib/systemd/system"</span> <span class="token string">"/opt/photoview/systemd/photoview.service"</span><br>$ <span class="token function">sudo</span> <span class="token function">install</span> -Dm0644 <span class="token string">"/opt/photoview/systemd/photoview.sysusers.conf"</span> <span class="token string">"/usr/lib/sysusers.d/photoview.conf"</span><br>$ <span class="token function">sudo</span> <span class="token function">install</span> -Dm0644 <span class="token string">"/opt/photoview/systemd/photoview.tmpfiles"</span> <span class="token string">"/usr/lib/tmpfiles.d/photoview.conf"</span><br>$ <span class="token function">sudo</span> <span class="token function">install</span> -d <span class="token string">"/var/cache/photoview/media_cache"</span><br>$ <span class="token function">sudo</span> <span class="token function">chown</span> -R photoview:photoview /var/cache/photoview<br>$ <span class="token builtin class-name">cd</span> /opt/photoview/ui/dist<br>$ <span class="token function">sudo</span> <span class="token function">find</span> * -type f -exec <span class="token function">install</span> -Dm0644 <span class="token string">"{}"</span> <span class="token string">"/usr/share/webapps/photoview-ui/{}"</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><br>$ <span class="token builtin class-name">cd</span> /opt/photoview/api<br>$ <span class="token function">sudo</span> <span class="token function">install</span> -Dm0755 -t <span class="token string">"/usr/lib/photoview"</span> <span class="token string">"/opt/photoview/api/photoview"</span><br>$ <span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/lib/photoview/photoview /usr/bin/photoview<br>$ <span class="token function">sudo</span> <span class="token function">find</span> data -type f -exec <span class="token function">install</span> -Dm0644 <span class="token string">"{}"</span> <span class="token string">"/usr/lib/photoview/{}"</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><br>$ <span class="token function">sudo</span> <span class="token function">install</span> -Dm0644 <span class="token string">"/opt/photoview/api/example.env"</span> <span class="token string">"/etc/photoview.env"</span><br><span class="token comment"># Seulement si vous utilisez `sqlite`:</span><br>$ <span class="token function">sudo</span> <span class="token function">install</span> -d <span class="token string">"/var/lib/photoview"</span><br>$ <span class="token function">sudo</span> <span class="token function">chown</span> -R photoview:photoview /var/lib/photoview</code></pre><h3 id="utiliser-le-fichier-systemd" tabindex="-1"><a class="header-anchor" href="#utiliser-le-fichier-systemd" aria-label="Anchor"></a> Utiliser le fichier <code>systemd</code></h3><ul><li>Pour démarrer (ou stopper) le service photoview :<ul><li><code>$ sudo systemctl &lt;start/stop&gt; photoview.service</code></li></ul></li><li>Pour activer (ou désactiver) le fichier pour démarrer automatiquement (ou non) au démarrage du système :<ul><li><code>$ sudo systemctl &lt;enable/disable&gt; photoview.service</code></li></ul></li><li>Pour visualiser le statut du process :<ul><li><code>$ sudo systemctl status photoview.service</code></li></ul><blockquote><p>Utilisez ceci pour visualiser les messages d'erreurs si <code>photoview</code> s'arrête de fonctionner</p></blockquote></li><li>Pour suivre les logs du service photoview pendant le fonctionnement, utilisez la commande suivante :<ul><li><code>$ sudo journalctl -f -b0 -u photoview.service</code></li></ul><blockquote><p>Utile pour débugguer en même temps que d'utiliser dans un autre terminal les commandes <code>start/stop</code></p></blockquote></li></ul></main></div></div><div id="search-overlay" class="hidden"><div id="search-dimmer" class="fixed top-0 left-0 w-full h-full bg-black opacity-10"></div><div class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-white shadow-lg border border-gray-200 rounded-md p-4 w-40rem overflow-y-auto h-3/4" role="dialog"><input id="search-field" type="search" class="mb-4 w-full py-2 px-3 text-sm border border-gray-200 rounded-md" placeholder="Search" aria-autocomplete="list" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" enterkeyhint="search" aria-controls="search-results-box"><div role="listbox" aria-label="Search" id="search-results-box" class="">Loading results...</div></div></div><script defer="defer" src="/docs/docs-scripts.js"></script></body></html>